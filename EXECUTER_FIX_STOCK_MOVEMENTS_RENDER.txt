========================================
CORRIGER stock_movements SUR RENDER
========================================

ðŸ“‹ PROBLÃˆME :
La route /stocks/movements ne fonctionne pas sur Render

ðŸ”§ SOLUTION :
ExÃ©cuter le script fix_stock_movements_postgresql.sql

========================================
Ã‰TAPES RAPIDES :
========================================

1. AccÃ©der au Shell PostgreSQL sur Render
   Dashboard Render â†’ Service PostgreSQL â†’ Shell/Connect

2. Copier le contenu du fichier :
   scripts/fix_stock_movements_postgresql.sql

3. Coller dans le terminal PostgreSQL et exÃ©cuter

OU

ExÃ©cuter directement :
psql $DATABASE_URL < scripts/fix_stock_movements_postgresql.sql

========================================
VÃ‰RIFICATION RAPIDE :
========================================

-- VÃ©rifier la structure
\d stock_movements

-- VÃ©rifier les index
SELECT indexname FROM pg_indexes WHERE tablename = 'stock_movements';

-- VÃ©rifier le type ENUM
SELECT enumlabel FROM pg_enum 
WHERE enumtypid = (SELECT oid FROM pg_type WHERE typname = 'movement_type')
ORDER BY enumsortorder;

-- Tester une requÃªte
SELECT COUNT(*) FROM stock_movements;

========================================
CE QUE LE SCRIPT CORRIGE :
========================================

âœ… Type ENUM movement_type avec toutes les valeurs
âœ… Colonne reference (si manquante)
âœ… Toutes les contraintes FK (from_depot, to_depot, from_vehicle, to_vehicle)
âœ… Tous les index nÃ©cessaires pour les performances
âœ… VÃ©rifications complÃ¨tes

========================================
âš ï¸ IMPORTANT :
========================================

- Le script est IDEMPOTENT (peut Ãªtre exÃ©cutÃ© plusieurs fois)
- Faites un BACKUP avant d'exÃ©cuter
- Utilise une TRANSACTION (BEGIN/COMMIT)

========================================

