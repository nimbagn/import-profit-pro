========================================
EXÃ‰CUTER LA MIGRATION COMPLÃˆTE SUR RENDER
========================================

ðŸ“‹ Ã‰TAPES RAPIDES :

1. AccÃ©der au Shell PostgreSQL sur Render
   - Dashboard Render â†’ Service PostgreSQL â†’ Shell/Connect

2. Copier le contenu du fichier :
   scripts/migration_complete_postgresql_render.sql

3. Coller dans le terminal PostgreSQL et exÃ©cuter

OU

ExÃ©cuter directement :
psql $DATABASE_URL < scripts/migration_complete_postgresql_render.sql

========================================
VÃ‰RIFICATION RAPIDE :
========================================

SELECT 
    'additional_permissions' as migration,
    CASE WHEN EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_name = 'users' AND column_name = 'additional_permissions'
    ) THEN 'âœ… OK' ELSE 'âŒ MANQUANT' END as status
UNION ALL
SELECT 
    'stock_item_id',
    CASE WHEN EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_name = 'price_list_items' AND column_name = 'stock_item_id'
    ) THEN 'âœ… OK' ELSE 'âŒ MANQUANT' END
UNION ALL
SELECT 
    'reference',
    CASE WHEN EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_name = 'stock_movements' AND column_name = 'reference'
    ) THEN 'âœ… OK' ELSE 'âŒ MANQUANT' END
UNION ALL
SELECT 
    'return_type',
    CASE WHEN EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_name = 'stock_returns' AND column_name = 'return_type'
    ) THEN 'âœ… OK' ELSE 'âŒ MANQUANT' END
UNION ALL
SELECT 
    'reception_return',
    CASE WHEN EXISTS (
        SELECT 1 FROM pg_enum 
        WHERE enumlabel = 'reception_return' 
        AND enumtypid = (SELECT oid FROM pg_type WHERE typname = 'movement_type')
    ) THEN 'âœ… OK' ELSE 'âŒ MANQUANT' END;

========================================
âš ï¸ IMPORTANT :
========================================

- Le script est IDEMPOTENT (peut Ãªtre exÃ©cutÃ© plusieurs fois)
- Faites un BACKUP avant d'exÃ©cuter
- La migration price_list_items supprime les donnÃ©es existantes

========================================

