{% extends "base_modern_complete.html" %}
{% block title %}Stock du Superviseur - Import Profit Pro{% endblock %}

{% block content %}
  <section class="page-section">
    <div class="page-header-promo">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <h1>
        <i class="fas fa-warehouse icon-promo"></i>
        Stock du Superviseur
      </h1>
      <div class="d-flex gap-2 flex-wrap">
        <a href="{{ url_for('promotion.workflow') }}" class="btn btn-promo" style="background: linear-gradient(135deg, #003865 0%, #005a9f 100%); color: white; border: none;">
          <i class="fas fa-sitemap me-2"></i>Workflow Processus
        </a>
        {% if has_permission(current_user, 'promotion.write') %}
        <a href="{{ url_for('promotion.supervisor_stock_add') }}" class="btn btn-promo btn-promo-success">
          <i class="fas fa-plus me-2"></i>Ajouter du Stock
        </a>
        {% endif %}
        <a href="{{ url_for('promotion.supervisor_stock_movements') }}" class="btn btn-promo btn-promo-info">
          <i class="fas fa-history me-2"></i>Historique des Mouvements
        </a>
        <a href="{{ url_for('promotion.dashboard') }}" class="btn btn-promo" style="background: #6c757d; color: white;">
          <i class="fas fa-arrow-left me-2"></i>Retour au Dashboard
        </a>
      </div>
    </div>
  </div>

  <div class="stats-grid section-spacing">
    <div class="stat-card-promo">
      <div class="stat-card-promo-value" style="color: #003865;">{{ total_quantity or 0 }}</div>
      <div class="stat-card-promo-label">Total Gammes en Stock</div>
      <i class="fas fa-boxes stat-card-promo-icon"></i>
    </div>
    <div class="stat-card-promo">
      <div class="stat-card-promo-value" style="color: #10b981;">{{ "{:,.0f}".format(total_stock_value|default(0))|replace(',', ' ') }} GNF</div>
      <div class="stat-card-promo-label">Valeur Totale du Stock</div>
      <i class="fas fa-dollar-sign stat-card-promo-icon" style="color: #10b981;"></i>
    </div>
    <div class="stat-card-promo">
      <div class="stat-card-promo-value" style="color: #005a9f;">{{ stock_data|length }}</div>
      <div class="stat-card-promo-label">Nombre de Types de Gammes</div>
      <i class="fas fa-list stat-card-promo-icon" style="color: #005a9f;"></i>
    </div>
  </div>

  <div class="card-promo">
    <div class="card-promo-header">
      <i class="fas fa-boxes me-2"></i>Détail du Stock par Gamme
    </div>
    <div style="padding: 1.5rem;">
      {% if stock_data and stock_data|selectattr('quantity', 'gt', 0)|list %}
      <div class="table-responsive" style="margin: 0 auto; width: 100%;">
        <table class="table table-promo">
          <thead>
            <tr>
              <th>Gamme</th>
              <th>Type</th>
              <th>Quantité en Stock</th>
              <th>Prix de Vente (GNF)</th>
              <th>Valeur Totale (GNF)</th>
              <th>Dernière Mise à Jour</th>
            </tr>
          </thead>
          <tbody>
            {% for item in stock_data %}
            {% if item.quantity > 0 %}
            <tr>
              <td><strong>{{ item.gamme.name }}</strong></td>
              <td>
                {% if item.gamme.is_piece %}
                <span class="badge badge-promo badge-promo-info">{{ item.gamme.unit_type or 'Pièce' }}</span>
                {% else %}
                <span class="badge badge-promo" style="background: #6c757d; color: white;">Gamme</span>
                {% endif %}
              </td>
              <td>
                <span class="badge badge-promo badge-promo-primary" style="font-size: 1.1em;">{{ item.quantity }}</span>
              </td>
              <td><strong class="data-highlight">{{ "{:,.0f}".format(item.gamme.selling_price_gnf|default(0))|replace(',', ' ') }} GNF</strong></td>
              <td><strong class="data-positive">{{ "{:,.0f}".format(item.value|default(0))|replace(',', ' ') }} GNF</strong></td>
              <td>
                {% if item.last_updated %}
                {{ item.last_updated.strftime('%d/%m/%Y %H:%M') }}
                {% else %}
                <span class="text-muted">-</span>
                {% endif %}
              </td>
            </tr>
            {% endif %}
            {% endfor %}
          </tbody>
          <tfoot>
            <tr style="background: linear-gradient(135deg, rgba(0, 56, 101, 0.08) 0%, rgba(0, 90, 159, 0.08) 100%); border-top: 2px solid #003865;">
              <td colspan="2" style="text-align: center;"><strong style="font-size: 1.1em;">TOTAL</strong></td>
              <td style="text-align: center;"><strong class="data-highlight" style="font-size: 1.1em;">{{ total_quantity }}</strong></td>
              <td colspan="2" style="text-align: center;"><strong class="data-positive" style="font-size: 1.1em;">{{ "{:,.0f}".format(total_stock_value|default(0))|replace(',', ' ') }} GNF</strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
      {% else %}
      <div class="text-center text-muted py-5">
        <i class="fas fa-box-open fa-3x mb-3"></i>
        <p><strong>Aucun stock enregistré pour le superviseur.</strong></p>
        <p class="text-muted mb-3">Vous devez d'abord ajouter du stock au superviseur avant de pouvoir approvisionner les équipes.</p>
        {% if has_permission(current_user, 'promotion.write') %}
        <a href="{{ url_for('promotion.supervisor_stock_add') }}" class="btn btn-promo btn-promo-success">
          <i class="fas fa-plus me-2"></i>Ajouter du Stock Maintenant
        </a>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </section>
{% endblock %}

